{
  "domain": "embedded_forge",
  "description": "ESP32 + Forge Theory Combined",
  "file_types": [".ino", ".cpp", ".h", ".py"],
  "hardware_profiles": {
    "ESP32": {
      "adc_resolution": 4095,
      "pwm_function": "ledcWrite",
      "forbidden_functions": ["analogWrite"]
    }
  },
  "validation_rules": {
    "safety": [
      {
        "id": "safety_timeout",
        "severity": "error",
        "message": "Critical: No safety timeout detected",
        "trigger": ["motor", "servo"],
        "required_pattern": "millis() - lastCommand > SAFETY_TIMEOUT",
        "auto_fix": "inject_safety_timeout"
      }
    ],
    "formulas": [
      {
        "id": "decay_negative_exponent",
        "severity": "error",
        "message": "Decay formulas require NEGATIVE exponent: exp(-t/τ)",
        "trigger": ["decay", "discharge", "cool", "fade"],
        "forbidden": ["exp(t/", "(1 - exp"],
        "required_pattern": "exp(-",
        "auto_fix": "fix_decay_formula"
      },
      {
        "id": "growth_complement",
        "severity": "error",
        "message": "Growth formulas require complement form: (1 - exp(-t/τ))",
        "trigger": ["charge", "heat", "rise", "grow"],
        "forbidden": ["exp(t/"],
        "required_pattern": "(1 - exp(-",
        "auto_fix": "fix_growth_formula"
      },
      {
        "id": "step_response_sign",
        "severity": "error",
        "message": "Step response requires negative exponent",
        "trigger": ["servo", "motor", "position"],
        "exclude_context": ["PID", "integral", "error"],
        "forbidden": ["(1 - exp(t/"],
        "required_pattern": "(1 - exp(-",
        "auto_fix": "fix_step_response"
      },
      {
        "id": "pid_dt_scaling",
        "severity": "warning",
        "message": "PID terms should scale with dt",
        "trigger": ["integral +=", "error_sum +="],
        "required_pattern": "dt",
        "auto_fix": "fix_pid_dt"
      }
    ],
    "hardware_specific": [
      {
        "id": "esp32_pwm",
        "platform": "ESP32",
        "forbidden": "analogWrite",
        "auto_fix": "esp32_pwm_fix"
      }
    ]
  }
}